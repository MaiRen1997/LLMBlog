<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LangChain的基本使用 | 麦仁大模型博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="记录大模型学习">
    
    <link rel="preload" href="/LLMBlog/assets/css/0.styles.1c990687.css" as="style"><link rel="preload" href="/LLMBlog/assets/js/app.ff17da13.js" as="script"><link rel="preload" href="/LLMBlog/assets/js/2.ba391ffa.js" as="script"><link rel="preload" href="/LLMBlog/assets/js/8.c846d111.js" as="script"><link rel="prefetch" href="/LLMBlog/assets/js/10.19dfe007.js"><link rel="prefetch" href="/LLMBlog/assets/js/11.5d9f955a.js"><link rel="prefetch" href="/LLMBlog/assets/js/12.4b9efd28.js"><link rel="prefetch" href="/LLMBlog/assets/js/13.254de717.js"><link rel="prefetch" href="/LLMBlog/assets/js/14.e63b5b34.js"><link rel="prefetch" href="/LLMBlog/assets/js/15.f344742a.js"><link rel="prefetch" href="/LLMBlog/assets/js/16.7d58fc7f.js"><link rel="prefetch" href="/LLMBlog/assets/js/17.5cbb2dc2.js"><link rel="prefetch" href="/LLMBlog/assets/js/18.90726f3f.js"><link rel="prefetch" href="/LLMBlog/assets/js/19.c068ab3e.js"><link rel="prefetch" href="/LLMBlog/assets/js/20.c0816684.js"><link rel="prefetch" href="/LLMBlog/assets/js/21.81609118.js"><link rel="prefetch" href="/LLMBlog/assets/js/22.fa49fa7c.js"><link rel="prefetch" href="/LLMBlog/assets/js/23.cf166c0c.js"><link rel="prefetch" href="/LLMBlog/assets/js/24.0c4802ff.js"><link rel="prefetch" href="/LLMBlog/assets/js/25.b88f05c1.js"><link rel="prefetch" href="/LLMBlog/assets/js/26.5265d199.js"><link rel="prefetch" href="/LLMBlog/assets/js/27.9cc54af0.js"><link rel="prefetch" href="/LLMBlog/assets/js/28.d0e015e6.js"><link rel="prefetch" href="/LLMBlog/assets/js/29.3849962c.js"><link rel="prefetch" href="/LLMBlog/assets/js/3.a026143a.js"><link rel="prefetch" href="/LLMBlog/assets/js/30.a3cd6c5f.js"><link rel="prefetch" href="/LLMBlog/assets/js/31.06baa8fa.js"><link rel="prefetch" href="/LLMBlog/assets/js/32.ffbf7cfa.js"><link rel="prefetch" href="/LLMBlog/assets/js/33.3bffe434.js"><link rel="prefetch" href="/LLMBlog/assets/js/34.180eea75.js"><link rel="prefetch" href="/LLMBlog/assets/js/35.593a1c64.js"><link rel="prefetch" href="/LLMBlog/assets/js/4.6b2c893c.js"><link rel="prefetch" href="/LLMBlog/assets/js/5.8d021ce3.js"><link rel="prefetch" href="/LLMBlog/assets/js/6.69947064.js"><link rel="prefetch" href="/LLMBlog/assets/js/7.b7881b4b.js"><link rel="prefetch" href="/LLMBlog/assets/js/9.1f0479b7.js">
    <link rel="stylesheet" href="/LLMBlog/assets/css/0.styles.1c990687.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/LLMBlog/" class="home-link router-link-active"><!----> <span class="site-name">麦仁大模型博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/LLMBlog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/LLMBlog/Transformer/" class="nav-link">Transformer</a></div><div class="nav-item"><a href="/LLMBlog/promptEngineer/" class="nav-link">提示词工程</a></div><div class="nav-item"><a href="/LLMBlog/RAG/" class="nav-link">RAG</a></div><div class="nav-item"><a href="/LLMBlog/LangChain/" class="nav-link">LangChain</a></div><div class="nav-item"><a href="/LLMBlog/Agent/" class="nav-link">Agent</a></div><div class="nav-item"><a href="/LLMBlog/Fine-tuning/" class="nav-link">微调</a></div><div class="nav-item"><a href="/LLMBlog/Multimodal/" class="nav-link">多模态</a></div><div class="nav-item"><a href="/LLMBlog/PrivateDeploy/" class="nav-link">私有化部署</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/LLMBlog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/LLMBlog/Transformer/" class="nav-link">Transformer</a></div><div class="nav-item"><a href="/LLMBlog/promptEngineer/" class="nav-link">提示词工程</a></div><div class="nav-item"><a href="/LLMBlog/RAG/" class="nav-link">RAG</a></div><div class="nav-item"><a href="/LLMBlog/LangChain/" class="nav-link">LangChain</a></div><div class="nav-item"><a href="/LLMBlog/Agent/" class="nav-link">Agent</a></div><div class="nav-item"><a href="/LLMBlog/Fine-tuning/" class="nav-link">微调</a></div><div class="nav-item"><a href="/LLMBlog/Multimodal/" class="nav-link">多模态</a></div><div class="nav-item"><a href="/LLMBlog/PrivateDeploy/" class="nav-link">私有化部署</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/LLMBlog/pages/33d462/" aria-current="page" class="active sidebar-link">LangChain的基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/LLMBlog/pages/33d462/#langchain的核心功能" class="sidebar-link">LangChain的核心功能</a></li><li class="sidebar-sub-header level2"><a href="/LLMBlog/pages/33d462/#实例化大模型" class="sidebar-link">实例化大模型</a></li><li class="sidebar-sub-header level2"><a href="/LLMBlog/pages/33d462/#初始化提示词模板" class="sidebar-link">初始化提示词模板</a></li><li class="sidebar-sub-header level2"><a href="/LLMBlog/pages/33d462/#链式调用大模型" class="sidebar-link">链式调用大模型</a></li></ul></li><li><a href="/LLMBlog/pages/8b70ff/" class="sidebar-link">(原生)绑定自定义工具</a></li><li><a href="/LLMBlog/pages/1bd4e4/" class="sidebar-link">Agent绑定工具</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/LLMBlog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/LLMBlog/LangChain/#LangChain&amp;LangGraph" data-v-06225672>LangChain&amp;LangGraph</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2026-02-24</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">LangChain的基本使用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="langchain的核心功能"><a href="#langchain的核心功能" class="header-anchor">#</a> LangChain的核心功能</h2> <ul><li><strong>模型（Models）</strong>：提供统一接口调用各种LLM，如OpenAI的GPT系列、Anthropic的Claude系列、Google的Gemini系列，以及Hugging Face的开源模型。</li> <li><strong>提示（Prompts）</strong>：优化模型输入，提升生成结果的质量，包括PromptTemplate、ChatPromptTemplate和FewShotPromptTemplate等。</li> <li><strong>链（Chains）</strong>：封装多个组件的调用序列，创建复杂的工作流程，如SimpleSequentialChain等。</li> <li><strong>代理（Agents）</strong>：允许模型自主调用外部工具和组件，实现多步骤任务处理，如AutoGPT和BabyAGI。</li> <li><strong>记忆（Memory）</strong>：存储和检索对话数据，支持上下文感知的应用，如多轮对话系统。</li> <li><strong>索引（Indexes）</strong>：组织和检索文档数据，支持RAG（检索增强生成）等应用场景。</li></ul> <h2 id="实例化大模型"><a href="#实例化大模型" class="header-anchor">#</a> 实例化大模型</h2> <h3 id="实例化大模型-2"><a href="#实例化大模型-2" class="header-anchor">#</a> 实例化大模型</h3> <h4 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI
llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>
    model<span class="token operator">=</span><span class="token string">&quot;qwen-max-latest&quot;</span><span class="token punctuation">,</span>
    base_url<span class="token operator">=</span><span class="token string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><span class="token punctuation">,</span>
    api_key<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    streaming<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
resp <span class="token operator">=</span> llm<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token string">&quot;100 + 100 = ?&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre></div><p>注意 api_key 会提示：Expected type 'SecretStr | None', got 'str' instead 错误</p> <h4 id="流式输出"><a href="#流式输出" class="header-anchor">#</a> 流式输出</h4> <p>只需要将invoke换成stream</p> <div class="language-python extra-class"><pre class="language-python"><code>resp <span class="token operator">=</span> llm<span class="token punctuation">.</span>stream<span class="token punctuation">(</span><span class="token string">&quot;100 + 100 = ?&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> resp<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>content<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="使用secretstr类型对api-key进行加密"><a href="#使用secretstr类型对api-key进行加密" class="header-anchor">#</a> 使用SecretStr类型对api_key进行加密</h3> <p>安装 pydantic：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>uv <span class="token function">add</span> pydantic
</code></pre></div><p><strong>Pydantic</strong> 是一个基于 Python 类型注解（type hints）的<strong>数据验证与解析库</strong>，广泛用于数据模型定义、数据验证、序列化和反序列化。它通过定义类（继承自 <code>BaseModel</code>）和类型注解，自动验证输入数据的结构和类型，确保数据符合预期格式，并提供清晰的错误信息。官网：https://docs.pydantic.dev/</p> <p>可以使用 SecretStr 进行优化：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pydantic <span class="token keyword">import</span> SecretStr

api_key<span class="token operator">=</span>SecretStr<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="初始化提示词模板"><a href="#初始化提示词模板" class="header-anchor">#</a> 初始化提示词模板</h2> <h3 id="prompttemplate-字符串提示模板"><a href="#prompttemplate-字符串提示模板" class="header-anchor">#</a> PromptTemplate(字符串提示模板)</h3> <h4 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h4> <ol><li>先使用<code>PromptTemplate.from_template</code>创建提示词模板</li> <li>再使用<code>模板.format</code>进行代码补充完整，参数要和模板对齐</li> <li>再将整理好的模板传给大模型</li></ol> <h4 id="适用场景"><a href="#适用场景" class="header-anchor">#</a> <strong>适用场景</strong>：</h4> <ul><li>用于<strong>文本补全模型</strong>，输入是纯文本（单字符串）。</li> <li>适用于简单的任务，例如生成一段文本、回答问题或执行指令。</li></ul> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> <strong>特点</strong>：</h4> <ul><li><strong>输入变量插值</strong>：通过 <code>{}</code> 占位符动态替换变量。</li> <li><strong>模板格式</strong>：支持 <code>f-string</code>。</li> <li><strong>输出形式</strong>：生成一个完整的字符串作为模型输入。</li></ul> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <div class="language-python extra-class"><pre class="language-python"><code>template_prompt <span class="token operator">=</span> PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span><span class="token string">&quot;今天{something}真不错&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>template_prompt<span class="token punctuation">)</span> <span class="token comment"># input_variables=['something'] input_types={} partial_variables={} template='今天{something}真不错'</span>

formatted_prompt <span class="token operator">=</span> template_prompt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>something<span class="token operator">=</span><span class="token string">&quot;天气&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>formatted_prompt<span class="token punctuation">)</span> <span class="token comment"># 今天天气真不错</span>
</code></pre></div><h3 id="chatprompttemplate-聊天提示模板"><a href="#chatprompttemplate-聊天提示模板" class="header-anchor">#</a> ChatPromptTemplate(聊天提示模板)</h3> <h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <ol><li>使用<code>ChatPromptTemplate.from_messages</code>创建模板，<code>参数是一个数组</code>，数组内是<code>元组</code></li> <li>使用<code>模板.format_messages</code> 补充好模板，参数要和上面模板的形参保持一致</li></ol> <h4 id="适用场景-2"><a href="#适用场景-2" class="header-anchor">#</a> <strong>适用场景</strong>：</h4> <ul><li>用于<strong>聊天模型</strong>（如 ChatGPT / 通义千问等），输入是多轮对话的消息列表（<code>SystemMessage</code>、<code>HumanMessage</code>、<code>AIMessage</code> 等）。</li> <li>适用于需要模拟多轮对话或角色扮演的场景。</li></ul> <h4 id="特点-2"><a href="#特点-2" class="header-anchor">#</a> <strong>特点</strong>：</h4> <ul><li><strong>多消息类型支持</strong>：可以组合系统指令、用户输入和助手回复。</li> <li><strong>消息格式化</strong>：生成结构化的消息列表，供聊天模型处理。</li> <li><strong>灵活性</strong>：支持动态替换变量（如 <code>SystemMessage</code> 中的占位符）。</li></ul> <h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI
<span class="token keyword">from</span> langchain_core<span class="token punctuation">.</span>prompts <span class="token keyword">import</span> ChatPromptTemplate
llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>
    model<span class="token operator">=</span><span class="token string">&quot;qwen-max-latest&quot;</span><span class="token punctuation">,</span>
    base_url<span class="token operator">=</span><span class="token string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><span class="token punctuation">,</span>
    api_key<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    streaming<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
system_message <span class="token operator">=</span> <span class="token string">&quot;你是一位{role}专家，擅长回答{domain}领域的问题。&quot;</span>
human_message <span class="token operator">=</span> <span class="token string">&quot;{question}&quot;</span>

chat_prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> system_message<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;human&quot;</span><span class="token punctuation">,</span> human_message<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 格式化消息</span>
formatted_messages <span class="token operator">=</span> chat_prompt<span class="token punctuation">.</span>format_messages<span class="token punctuation">(</span>
    role<span class="token operator">=</span><span class="token string">&quot;技术&quot;</span><span class="token punctuation">,</span>
    domain<span class="token operator">=</span><span class="token string">&quot;Web开发&quot;</span><span class="token punctuation">,</span>
    question<span class="token operator">=</span><span class="token string">&quot;如何构建一个基于Vue的前端应用？&quot;</span>
<span class="token punctuation">)</span>
resp <span class="token operator">=</span> llm<span class="token punctuation">.</span>stream<span class="token punctuation">(</span>formatted_messages<span class="token punctuation">)</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> resp<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>content<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
[
  SystemMessage(content='你是一位技术专家，擅长回答Web开发领域的问题。', additional_kwargs={}, response_metadata={}),
  HumanMessage(content='如何构建一个基于Vue的前端应用？', additional_kwargs={}, response_metadata={})
]
&quot;&quot;&quot;</span>
</code></pre></div><blockquote><p>python基础知识扩充：</p> <p>这里的 <code>(&quot;system&quot;, system_message)</code>是 python 的 tuple 类型</p> <p><strong>Tuple（元组）</strong>：</p> <ul><li><strong>有序</strong>：元素按顺序排列，支持索引和切片操作。</li> <li><strong>不可变</strong>：<strong>创建后无法修改（不能增删改元素）</strong>。</li> <li><strong>定义方式</strong>：使用圆括号 <code>()</code> 或直接逗号分隔元素。</li></ul> <p><strong>Array（数组）</strong>：相当于 JS 中的 Array</p> <ul><li><strong>可变</strong>：可以动态添加、删除或修改元素。</li> <li><strong>有序</strong>：元素按顺序排列，支持索引和切片。</li></ul> <p><strong>Dict（字典）</strong>：相当于 JS 中的 Object</p> <ul><li><strong>无序</strong>：元素（键值对）没有固定顺序。</li> <li><strong>可变</strong>：可以动态添加、删除或修改键值对。</li> <li><strong>定义方式</strong>：使用花括号 <code>{}</code>，键值对用冒号 <code>:</code> 分隔。</li></ul></blockquote> <h3 id="chatmessageprompttemplate与chatprompttemplate结合"><a href="#chatmessageprompttemplate与chatprompttemplate结合" class="header-anchor">#</a> ChatMessagePromptTemplate与ChatPromptTemplate结合</h3> <h4 id="步骤-2"><a href="#步骤-2" class="header-anchor">#</a> 步骤</h4> <ol><li>使用<code>ChatMessagePromptTemplate.from_template</code>构建模板</li> <li>使用<code>ChatPromptTemplate.from_messages</code>组合成消息提示词模板</li> <li>使用<code>消息提示词模板.format_messages</code>填充实现提示词模板</li> <li>将填充好的提示词模板，传递给大模型</li></ol> <p>知识扩充：<code>ChatMessagePromptTemplate</code>可以结合 <code>ChatPromptTemplate</code>使用，同时对提示词模板和消息体进行抽象和复用：</p> <div class="language-python extra-class"><pre class="language-python"><code>system_template <span class="token operator">=</span> ChatMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>
    template<span class="token operator">=</span><span class="token string">&quot;你是一位{role}专家，擅长回答{domain}领域的问题。&quot;</span><span class="token punctuation">,</span>
    role<span class="token operator">=</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

human_template <span class="token operator">=</span> ChatMessagePromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>
    template<span class="token operator">=</span><span class="token string">&quot;用户问题：{question}&quot;</span><span class="token punctuation">,</span>
    role<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

chat_prompt <span class="token operator">=</span> ChatPromptTemplate<span class="token punctuation">.</span>from_messages<span class="token punctuation">(</span><span class="token punctuation">[</span>
    system_template<span class="token punctuation">,</span>
    human_template<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

messages <span class="token operator">=</span> chat_prompt<span class="token punctuation">.</span>format_messages<span class="token punctuation">(</span>
    role<span class="token operator">=</span><span class="token string">&quot;技术&quot;</span><span class="token punctuation">,</span>
    domain<span class="token operator">=</span><span class="token string">&quot;Web开发&quot;</span><span class="token punctuation">,</span>
    question<span class="token operator">=</span><span class="token string">&quot;如何构建一个基于Vue的前端应用？&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
[
  ChatMessage(content='你是一位技术专家，擅长回答Web开发领域的问题。', additional_kwargs={}, response_metadata={}, role='system'),
  ChatMessage(content='用户问题：如何构建一个基于Vue的前端应用？', additional_kwargs={}, response_metadata={}, role='human')
]
&quot;&quot;&quot;</span>
</code></pre></div><h3 id="fewshotprompttemplate"><a href="#fewshotprompttemplate" class="header-anchor">#</a> FewShotPromptTemplate</h3> <h4 id="适用场景-3"><a href="#适用场景-3" class="header-anchor">#</a> <strong>适用场景</strong>：</h4> <ul><li>用于<strong>少样本学习</strong>（Few-Shot Learning），在提示中包含示例（Examples），帮助模型理解任务。</li> <li>适用于复杂任务（如翻译、分类、推理），需要通过示例引导模型行为。</li></ul> <h4 id="特点-3"><a href="#特点-3" class="header-anchor">#</a> <strong>特点</strong>：</h4> <ul><li><strong>示例嵌入</strong>：通过 <code>examples</code> 参数提供示例输入和输出。</li> <li><strong>动态示例选择</strong>：支持 <code>ExampleSelector</code> 动态选择最相关的示例。</li> <li><strong>模板格式</strong>：通常包含前缀（Prefix）、示例（Examples）和后缀（Suffix）。</li></ul> <h4 id="步骤-3"><a href="#步骤-3" class="header-anchor">#</a> 步骤</h4> <ol><li>定义<code>示例模板</code>，比如输入xx，输出xx</li> <li>根据上面的示例模板，<code>定义数组类型的示例，形参要和模板对应上</code></li> <li>设置前置文本</li> <li>设置后置文本，也就是整段提示词最后的后缀
由于前面的都通过example_template和examples，整理好了格式
对于为了避免用户需要每次按照这个格式输出，可以设置后缀，让用户只需要输入关键信息，由suffix整理成和上面一样的格式</li> <li>指定输入的变量名称：<code>input_variables=[&quot;变量名&quot;]</code>，指定用户传入的数据，被赋值到哪个参数上了</li> <li>将<code>少量模板，进行填充，然后传给大模型</code></li></ol> <h4 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> <strong>示例</strong>：</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 定义示例模板</span>
example_template <span class="token operator">=</span> <span class="token string">&quot;输入: {input}\n输出: {output}&quot;</span>

<span class="token comment"># 创建示例</span>
examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;将'Hello'翻译成中文&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;将'Goodbye'翻译成中文&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;再见&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 创建少样本模板</span>
few_shot_prompt <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>example_template<span class="token punctuation">)</span><span class="token punctuation">,</span>
    prefix<span class="token operator">=</span><span class="token string">&quot;请将以下英文翻译成中文：&quot;</span><span class="token punctuation">,</span>
    suffix<span class="token operator">=</span><span class="token string">&quot;输入: {text}\n输出:&quot;</span><span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># 格式化提示</span>
formatted_prompt <span class="token operator">=</span> few_shot_prompt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">&quot;Thank you&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>formatted_prompt<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
请将以下英文翻译成中文：

输入: 将'Hello'翻译成中文
输出: 你好

输入: 将'Goodbye'翻译成中文
输出: 再见

输入: Thank you
输出:
&quot;&quot;&quot;</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <h4 id="常用模板类特性和使用场景对比"><a href="#常用模板类特性和使用场景对比" class="header-anchor">#</a> 常用模板类特性和使用场景对比</h4> <table><thead><tr><th><strong>子类</strong></th> <th><strong>适用模型类型</strong></th> <th><strong>输入类型</strong></th> <th><strong>主要用途</strong></th></tr></thead> <tbody><tr><td><code>PromptTemplate</code></td> <td>文本补全模型</td> <td>单字符串</td> <td>生成单轮文本任务的提示</td></tr> <tr><td><code>ChatPromptTemplate</code></td> <td>聊天模型</td> <td>多消息列表</td> <td>模拟多轮对话或角色扮演</td></tr> <tr><td><code>FewShotPromptTemplate</code></td> <td>所有模型</td> <td>包含示例的模板</td> <td>通过示例引导模型完成复杂任务</td></tr></tbody></table> <h4 id="常用提示词模板类的继承关系"><a href="#常用提示词模板类的继承关系" class="header-anchor">#</a> 常用提示词模板类的继承关系</h4> <p><img src="/LLMBlog/assets/img/extendRelation.936b26ba.png" alt=""></p> <h2 id="链式调用大模型"><a href="#链式调用大模型" class="header-anchor">#</a> 链式调用大模型</h2> <ol><li>先不进行few_shot_prompt.format填充完整模板，而是先把<code>提示词模板prompt</code>和<code>大模型llm</code> 组装在一起</li></ol> <div class="language-python extra-class"><pre class="language-python"><code> 定义示例模板
example_template <span class="token operator">=</span> <span class="token string">&quot;输入: {input}\n输出: {output}&quot;</span>

<span class="token comment"># 创建示例</span>
examples <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;将'Hello'翻译成中文&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;将'Goodbye'翻译成中文&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;output&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;再见&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 创建少样本模板</span>
few_shot_prompt <span class="token operator">=</span> FewShotPromptTemplate<span class="token punctuation">(</span>
    examples<span class="token operator">=</span>examples<span class="token punctuation">,</span>
    example_prompt<span class="token operator">=</span>PromptTemplate<span class="token punctuation">.</span>from_template<span class="token punctuation">(</span>example_template<span class="token punctuation">)</span><span class="token punctuation">,</span>
    prefix<span class="token operator">=</span><span class="token string">&quot;请将以下英文翻译成中文：&quot;</span><span class="token punctuation">,</span>
    suffix<span class="token operator">=</span><span class="token string">&quot;输入: {text}\n输出:&quot;</span><span class="token punctuation">,</span>
    input_variables<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token comment"># 格式化提示</span>
<span class="token comment">## formatted_prompt = few_shot_prompt.format(text=&quot;Thank you&quot;)</span>


chain <span class="token operator">=</span> few_shot_prompt <span class="token operator">|</span> llm

response <span class="token operator">=</span> chain<span class="token punctuation">.</span>stream<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Thank you&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># response = chain.stream(input={&quot;user_input&quot;: &quot;计算100+100&quot;})</span>

<span class="token keyword">for</span> chunk <span class="token keyword">in</span> response<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>content<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
</code></pre></div></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/LLMBlog/pages/8b70ff/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">(原生)绑定自定义工具</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/LLMBlog/pages/8b70ff/">(原生)绑定自定义工具</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/LLMBlog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/LLMBlog/pages/8b70ff/"><div>
            (原生)绑定自定义工具
            <!----></div></a> <span class="date">02-27</span></dt></dl><dl><dd>02</dd> <dt><a href="/LLMBlog/pages/1bd4e4/"><div>
            Agent绑定工具
            <!----></div></a> <span class="date">02-27</span></dt></dl><dl><dd>03</dd> <dt><a href="/LLMBlog/pages/c24827/"><div>
            百炼模型的使用
            <!----></div></a> <span class="date">02-24</span></dt></dl> <dl><dd></dd> <dt><a href="/LLMBlog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/LLMBlog/assets/js/app.ff17da13.js" defer></script><script src="/LLMBlog/assets/js/2.ba391ffa.js" defer></script><script src="/LLMBlog/assets/js/8.c846d111.js" defer></script>
  </body>
</html>
